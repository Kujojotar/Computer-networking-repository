# 第三章：运输层

##### 运输层概述

运输层位于应用层和网络层之间。该层为运行在不同主机上的应用进程提供直接的通信服务起着至关重要的作用。

运输层协议为运行在不同主机上的应用进程之间提供了逻辑通信功能。从应用程序的角度看，通过逻辑通信，运行不同进程的主机好像直接连接一样；实际上，这些主机也许位于地球的两端，通过很多路由器及不同类型的链路相连。应用进程使用运输层提供的逻辑通信功能彼此发送报文，而无需考虑承载这些报文的物理基础设施的细节。

运输层协议是在端系统而非路由器中实现的。在发送端，运输层将从发送应用进程接收到的报文转换成运输层分组，用因特网的术语来讲该分组称为运输层的报文段。实现方法可能是将应用报文划分成较小的块，并为每块加上一个运输层首部以生成运输层报文段。然后，在发送端系统中，运输层将这些报文段传递给网络层，网络层将其封装为网络层分组（即数据报）并向目的地发送。网络路由器仅作用于该数据报的网络层字段；即它们不检查封装在该数据报的运输层报文段的字段。运输层则处理接收到的报文段，使该报文段中的数据为接受应用程序所使用。

![image-20210109100521995](C:\Users\Jonny\AppData\Roaming\Typora\typora-user-images\image-20210109100521995.png)

##### 网络层与运输层的关系

网络层提供了主机之间的逻辑通信，而运输层提供了运行在不同主机上的进程的逻辑通信。运输层协议只工作在端系统，在端系统中，运输层协议将来自应用进程的报文移动到网络层，但对这些报文在网络核心如何移动并不做任何的规定。事实上，中间路由器既不处理也不识别运输层加在应用层报文的任何信息。计算机网络可以安排多种运输层协议，每种协议为应用程序提供不同的服务模型。

运输层协议能够提供的服务常常受制于底层网络层协议的服务模型。如果网络层协议无法为主机提供时延或带宽保证的话，运输层协议也无法提供时延或带宽保证。然而某些时候不一样，运输层协议可提供可靠数据传输服务，加密等网络层协议无法提供的服务。

##### 因特网运输层概述

网络层IP协议，即网际协议。IP的服务模型是**尽力而为交付服务**，IP尽自己最大努力在通信的主机之间交换报文段，但它不做任何的保证。它不确保报文段的交付，不保证报文段的按序交付，不保证报文段中数据的完整性。由于这些原因，IP被称为**不可靠服务**

UDP和TCP最基本的责任是，将两个端系统间IP的交付服务。把主机间交付到扩展到进程间的交付被称为**运输层的多路复用**与多路分解。UDP与TCP还可以通过在其报文段首部中包含差错检验字段而提供完整性检查。

进程到进程间的数据交付和差错检查是两种最低限度的运输层服务，也是UDP所能提供的仅有的两种服务。

TCP可以为应用程序提供几种附加服务。首先，它提供可靠数据传输。通过使用流量控制，序号，确认，定时器，TCP确保正确地，按序地将数据从发送进程交付给接收进程。这样，TCP将两个端系统间的不可靠IP服务转换为了一种进程间的可靠数据传输服务。TCP还提供**拥塞控制**。而在另一方面，UDP流量是不可调节的，使用UDP传输的应用程序可以根据其需要以其愿意的任何速率发送数据。